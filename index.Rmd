---
title: 'Brain Eno'
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    storyboard: true
---

```{r, cache = FALSE}
library(tidyverse)
library(plotly)
library(spotifyr)
library(dplyr)
library(ggplot2)
library(compmus)
source(file='spotify.R')
```

### Introduction
The man you probably heard of, either as synth man in Roxy music or as U2 producer. Brain Eno has certainly left his hark in the music industry. Not only has he produced very many albums, he even created a new music genre; ambient.

Since he has his own ways of producing (giving cards with random words on them to the U2 band members, to tell them how to sing and play). I decided to compare his solo work with his work as a producer, to see what his influences are in the work of albums he produced for certain bands. He produced music for several artists, but I am going to focus on Coldplay, U2, Devo, David Bowie, Genesis and the Talking Head. Because I think these bands had the most commercial success with their music produced under Eno.

I created two playlists. One of his solowork, consisting of only solo albums, ranging from art-/experimental rock-ish music, to ambient (to which he now still sticks). And one of alle the albums he produced with the aformentioned artists/bands.

### Characteristics

```{r, echo=FALSE}
enoproducer <- get_playlist_audio_features('21sm2glgseqq6otym3iwfbwsa', '0TEl4LaLPMjr7qPta5Z9pW')
enosolo <- get_playlist_audio_features('21sm2glgseqq6otym3iwfbwsa', '57ZXLIpoMu7mY8jWlWnCQl')

enoproducer %>% summarise(M = mean(valence), SD = sd(valence))
enosolo %>% summarise(M = mean(valence), SD = sd(valence))

enoproducer %>% summarise(mean = mean(energy), SD = sd(energy))
enosolo %>% summarise(M = mean(energy), SD = sd(energy))
```
When first analysing the music, I decided to take a look at valence and energy.
It is very striking that the valence and energy of Eno's solo work (0.23 and 0.24) are a lot lower than that of his work as a producer (0.47 and 0.66).

### Findings
```{r, fig.width=15}
eno <-
    enoproducer %>% mutate(playlist = "Producer") %>%
    bind_rows(enosolo %>% mutate(playlist = "Solo"))

label_enotable <-
    tibble(
        label = c("Remain in Light (TH)", "Another Green World"),
        playlist = c("Producer", "Solo"),
        valence = c(0.9630, 0.1580),
        energy = c(0.7630, 0.260000),
    )

eno %>%                       # Start with awards.
    ggplot(                      # Set up the plot.
        aes(
            x = valence,
            y = energy,
            size = loudness,
            colour = mode
        )
    ) +
    geom_point() +               # Scatter plot.
    geom_rug(size = 0.1) +       # Add 'fringes' to show data distribution.
    geom_text(                   # Add text labels from above.
        aes(
            x = valence,
            y = energy,
            label = label),
        colour = "black",        # Override colour (not mode here).
        size = 3,                # Override size (not loudness here).
        data = label_enotable,     # Specify the data source for labels.
        hjust = "left",          # Align left side of label with the point.
        vjust = "bottom",        # Align bottom of label with the point.
        nudge_x = -0.30,         # Nudge the label slightly left.
        nudge_y = 0.02           # Nudge the label slightly up.
    ) +
    facet_wrap(~ playlist) +     # Separate charts per playlist.
    scale_x_continuous(          # Fine-tune the x axis.
        limits = c(0, 1),
        breaks = c(0, 0.50, 1),  # Use grid-lines for quadrants only.
        minor_breaks = NULL      # Remove 'minor' grid-lines.
    ) +
    scale_y_continuous(          # Fine-tune the y axis in the same way.
        limits = c(0, 1),
        breaks = c(0, 0.50, 1),
        minor_breaks = NULL
    ) +
    scale_colour_brewer(         # Use the Color Brewer to choose a palette.
        type = "div",           # Qualitative set.
        palette = "PRGn"       # Name of the palette is 'Paired'.
    ) +
    scale_size_continuous(       # Fine-tune the sizes of each point.
        trans = "exp",           # Use an exp transformation to emphasise loud.
        guide = "none"           # Remove the legend for size.
    ) +
    theme_light() +              # Use a simpler them.
    labs(                        # Make the titles nice.
        x = "Valence",
        y = "Energy",
        colour = "Mode"
    )
```

***

You can see these details visualised here. Every point represents a song. You can see that a lot of songs from his solo work are concentrated in the bottom left corner of the graph. Meaning low valence and energy (also known as 'sad' songs). Most songs he produces are found in the upper half of the graph, meaning they are eiter 'angry' (top left corner) or 'happy' (top right corner).

### Chromagrams

```{r}
AGW <- 
    get_tidy_audio_analysis('660j84jp8ljIwLFiAFprlb') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, pitches)

AGW %>% 
    mutate(pitches = map(pitches, compmus_normalise, 'chebyshev')) %>% 
    compmus_gather_chroma %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = pitch_class, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    theme_minimal()
```
```{r}
RIL <- 
    get_tidy_audio_analysis('2FkJ8X6a1prYSYIdaEUItJ') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, pitches)

RIL %>% 
    mutate(pitches = map(pitches, compmus_normalise, 'chebyshev')) %>% 
    compmus_gather_chroma %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = pitch_class, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    theme_minimal()
```

```{r}
compmus_long_distance(
    AGW %>% mutate(pitches = map(pitches, compmus_normalise, 'chebyshev')),
    RIL %>% mutate(pitches = map(pitches, compmus_normalise, 'chebyshev')),
    feature = pitches,
    method = 'euclidean') %>% 
    ggplot(
        aes(
            x = xstart + xduration / 2, 
            width = xduration,
            y = ystart + yduration / 2,
            height = yduration,
            fill = d)) + 
    geom_tile() +
    scale_fill_continuous(type = 'viridis', guide = "none") +
    labs(x = 'Another Green World (Brian Eno)', y = 'Remain in the Light (Talking Heads)') +
    theme_minimal()
```

***

Text lalala

###Cepstograms and self-similarity

```{r}
AGW2 <- 
    get_tidy_audio_analysis('660j84jp8ljIwLFiAFprlb') %>% 
    compmus_align(bars, segments) %>% 
    select(bars) %>% unnest(bars) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'rms', norm = 'euclidean')) %>% 
    mutate(
        timbre = 
            map(segments, 
                compmus_summarise, timbre, 
                method = 'mean'))

RIL2 <- 
    get_tidy_audio_analysis('2FkJ8X6a1prYSYIdaEUItJ') %>% 
    compmus_align(bars, segments) %>% 
    select(bars) %>% unnest(bars) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'rms', norm = 'euclidean')) %>% 
    mutate(
        timbre = 
            map(segments, 
                compmus_summarise, timbre, 
                method = 'mean'))
```

```{r}
AGW2 %>% 
    compmus_gather_timbre %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = basis, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    scale_fill_viridis_c(option = 'E') +
    theme_classic()
```
```{r}
AGW2 %>% 
    compmus_self_similarity(timbre, 'cosine') %>% 
    ggplot(
        aes(
            x = xstart + xduration / 2, 
            width = xduration,
            y = ystart + yduration / 2,
            height = yduration,
            fill = d)) + 
    geom_tile() +
    coord_fixed() +
    scale_fill_viridis_c(option = 'E', guide = 'none') +
    theme_classic() +
    labs(x = '', y = '')
```

```{r}
RIL2 %>% 
    compmus_gather_timbre %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = basis, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    scale_fill_viridis_c(option = 'E') +
    theme_classic()
```
```{r}
RIL2 %>% 
    compmus_self_similarity(timbre, 'cosine') %>% 
    ggplot(
        aes(
            x = xstart + xduration / 2, 
            width = xduration,
            y = ystart + yduration / 2,
            height = yduration,
            fill = d)) + 
    geom_tile() +
    coord_fixed() +
    scale_fill_viridis_c(option = 'E', guide = 'none') +
    theme_classic() +
    labs(x = '', y = '')
```

***

First: Another Green World (Brian Eno)
Second: Remain in Light (Talking Heads)

You can see that Remain in Light has a much clearer checkerboard pattern which indicates that this song has a much clearer build-up than the ambient song 'another green world', which seems to have little to none structure.

###Chordograms and keygrams

```{r}
circshift <- function(v, n) {if (n == 0) v else c(tail(v, n), head(v, -n))}
                                    
    # C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B 
major_chord <- 
    c(1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <- 
    c(1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <- 
    c(1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <- 
    c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
    c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
    tribble(
        ~name  , ~template,
        'Gb:7'  , circshift(seventh_chord,  6),
        'Gb:maj', circshift(major_chord,    6),
        'Bb:min', circshift(minor_chord,   10),
        'Db:maj', circshift(major_chord,    1),
        'F:min' , circshift(minor_chord,    5),
        'Ab:7'  , circshift(seventh_chord,  8),
        'Ab:maj', circshift(major_chord,    8),
        'C:min' , circshift(minor_chord,    0),
        'Eb:7'  , circshift(seventh_chord,  3),
        'Eb:maj', circshift(major_chord,    3),
        'G:min' , circshift(minor_chord,    7),
        'Bb:7'  , circshift(seventh_chord, 10),
        'Bb:maj', circshift(major_chord,   10),
        'D:min' , circshift(minor_chord,    2),
        'F:7'   , circshift(seventh_chord,  5),
        'F:maj' , circshift(major_chord,    5),
        'A:min' , circshift(minor_chord,    9),
        'C:7'   , circshift(seventh_chord,  0),
        'C:maj' , circshift(major_chord,    0),
        'E:min' , circshift(minor_chord,    4),
        'G:7'   , circshift(seventh_chord,  7),
        'G:maj' , circshift(major_chord,    7),
        'B:min' , circshift(minor_chord,   11),
        'D:7'   , circshift(seventh_chord,  2),
        'D:maj' , circshift(major_chord,    2),
        'F#:min', circshift(minor_chord,    6),
        'A:7'   , circshift(seventh_chord,  9),
        'A:maj' , circshift(major_chord,    9),
        'C#:min', circshift(minor_chord,    1),
        'E:7'   , circshift(seventh_chord,  4),
        'E:maj' , circshift(major_chord,    4),
        'G#:min', circshift(minor_chord,    8),
        'B:7'   , circshift(seventh_chord, 11),
        'B:maj' , circshift(major_chord,   11),
        'D#:min', circshift(minor_chord,    3),
)

key_templates <-
    tribble(
        ~name    , ~template,
        'Gb:maj', circshift(major_key,  6),
        'Bb:min', circshift(minor_key, 10),
        'Db:maj', circshift(major_key,  1),
        'F:min' , circshift(minor_key,  5),
        'Ab:maj', circshift(major_key,  8),
        'C:min' , circshift(minor_key,  0),
        'Eb:maj', circshift(major_key,  3),
        'G:min' , circshift(minor_key,  7),
        'Bb:maj', circshift(major_key, 10),
        'D:min' , circshift(minor_key,  2),
        'F:maj' , circshift(major_key,  5),
        'A:min' , circshift(minor_key,  9),
        'C:maj' , circshift(major_key,  0),
        'E:min' , circshift(minor_key,  4),
        'G:maj' , circshift(major_key,  7),
        'B:min' , circshift(minor_key, 11),
        'D:maj' , circshift(major_key,  2),
        'F#:min', circshift(minor_key,  6),
        'A:maj' , circshift(major_key,  9),
        'C#:min', circshift(minor_key,  1),
        'E:maj' , circshift(major_key,  4),
        'G#:min', circshift(minor_key,  8),
        'B:maj' , circshift(major_key, 11),
        'D#:min', circshift(minor_key,  3))
```

```{r}
AGW3 <- 
    get_tidy_audio_analysis('660j84jp8ljIwLFiAFprlb') %>% 
    compmus_align(sections, segments) %>% 
    select(sections) %>% unnest(sections) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'mean', norm = 'manhattan'))

RIL3 <- 
    get_tidy_audio_analysis('2FkJ8X6a1prYSYIdaEUItJ') %>% 
    compmus_align(sections, segments) %>% 
    select(sections) %>% unnest(sections) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'mean', norm = 'manhattan'))
```

```{r}
AGW3 %>% 
    compmus_match_pitch_template(key_templates, 'euclidean', 'manhattan') %>% 
    ggplot(
        aes(x = start + duration / 2, width = duration, y = name, fill = d)) +
    geom_tile() +
    scale_fill_viridis_c(option = 'E', guide = 'none') +
    theme_minimal() +
    labs(x = 'Time (s)', y = '')
```

```{r}
RIL3 %>% 
    compmus_match_pitch_template(key_templates, 'euclidean', 'manhattan') %>% 
    ggplot(
        aes(x = start + duration / 2, width = duration, y = name, fill = d)) +
    geom_tile() +
    scale_fill_viridis_c(option = 'E', guide = 'none') +
    theme_minimal() +
    labs(x = 'Time (s)', y = '')
```

***

Text lalala